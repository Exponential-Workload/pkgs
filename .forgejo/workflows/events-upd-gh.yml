name: Update Events GH
run-name: Update GH
on: [push]

jobs:
  deploy:
    if: github.ref == 'refs/heads/senpai'
    runs-on: docker
    container:
      image: node:slim
    steps:
      - name: Enable Corepack
        run: corepack enable
      - name: Install Git
        run: apt update && apt install git openssh-client -y
      - name: Checkout
        uses: actions/checkout@v3
      - name: Configure Git
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.PRIVK }}" > ~/.ssh/id_ed25519
          echo "${{ secrets.PUBK }}" > ~/.ssh/id_ed25519.pub
          chmod 700 ~/.ssh/id_ed25519
          ssh-keyscan github.com >> ~/.ssh/known_hosts
      - name: Clone repository
        run: |
          git clone -b master --single-branch git@github.com:Exponential-Workload/events.git ../ev-repo
          cd ../ev-repo
          git config user.email "actions@codeberg.org"
          git config user.name "Codeberg Actions"
          git config --local http.extraheader "AUTHORIZATION: basic ${{ secrets.EVENT_PAT }}"
          cd -
      - name: Setup package
        run: |
          cp -r packages/@3xpo/events ../ev-out
          cp -r ../ev-repo/.git ../ev-out/.git

      - name: Commit and push changes
        run: |
          cd ../ev-out
          git add .
          git commit -m "chore: Update from Codeberg"
          git push --force git@github.com:Exponential-Workload/events.git master
